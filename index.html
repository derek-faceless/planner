<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÐœÐ¾Ð¹ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ñ‰Ð¸Ðº</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { overscroll-behavior: none; -webkit-overflow-scrolling: touch; }
  .mobile-tap { -webkit-tap-highlight-color: transparent; }
  .current-time { border-left-width: 4px; border-left-color: #3b82f6; }
  .slot { transition: background-color 0.2s; }
</style>
</head>
<body class="bg-gray-50">

<div id="app" class="min-h-screen flex flex-col"></div>

<script>
class Planner {
    constructor() {
        const today = new Date();
        this.daysOfWeek = ['ÐŸÐ','Ð’Ð¢','Ð¡Ð ','Ð§Ð¢','ÐŸÐ¢','Ð¡Ð‘','Ð’Ð¡'];
        this.state = {
            weekOffset: 0,
            selectedDay: today.getDay() === 0 ? 6 : today.getDay() - 1,
            schedule: JSON.parse(localStorage.getItem('schedule')) || {
                0: {work:true, gym:true, repair:true},
                1: {work:false, gym:false, repair:true},
                2: {work:true, gym:true, repair:true},
                3: {work:false, gym:false, repair:true},
                4: {work:true, gym:true, repair:true},
                5: {work:false, gym:false, repair:true},
                6: {work:false, gym:true, repair:true}
            },
            completed: JSON.parse(localStorage.getItem('completed')) || {},
            supplements: JSON.parse(localStorage.getItem('supplements')) || {}
        };
        this.suppConfig = [
            {id:1, name:'ÐÐ¼Ð¸Ð½Ð¾ÐºÐ¸ÑÐ»Ð¾Ñ‚Ñ‹', icon:'ðŸ’Š', timing:'wake'},
            {id:2, name:'ÐšÑ€ÐµÐ°Ñ‚Ð¸Ð½ (ÑƒÑ‚Ñ€Ð¾)', icon:'ðŸ’Š', timing:'wake'},
            {id:3, name:'ÐœÑƒÐ»ÑŒÑ‚Ð¸-Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ñ‹', icon:'ðŸŒŸ', timing:'breakfast'},
            {id:4, name:'ÐžÐ¼ÐµÐ³Ð° 3', icon:'ðŸŸ', timing:'breakfast'},
            {id:5, name:'Ð‘ÐµÑ‚Ð°-Ð°Ð»Ð°Ð½Ð¸Ð½', icon:'âš¡', timing:'pre-gym', gymOnly:true},
            {id:6, name:'Ð¦Ð¸Ñ‚Ñ€ÑƒÐ»Ð¸Ð½', icon:'âš¡', timing:'pre-gym', gymOnly:true},
            {id:7, name:'ÐšÑ€ÐµÐ°Ñ‚Ð¸Ð½ (Ð¿Ð¾ÑÐ»Ðµ)', icon:'ðŸ’Š', timing:'post-gym', gymOnly:true},
            {id:8, name:'Ð“ÐµÐ¹Ð½ÐµÑ€', icon:'ðŸ¥¤', timing:'post-gym', gymOnly:true, opt:true},
            {id:9, name:'Ð“Ð°Ð±Ð°', icon:'ðŸ˜´', timing:'sleep'},
            {id:10, name:'B-ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ', icon:'ðŸ’Š', timing:'sleep'}
        ];

        this.render();
        this.autoHighlightCurrentTime();
    }

    save() {
        localStorage.setItem('schedule', JSON.stringify(this.state.schedule));
        localStorage.setItem('completed', JSON.stringify(this.state.completed));
        localStorage.setItem('supplements', JSON.stringify(this.state.supplements));
    }

    getDays(offset){
        const today = new Date();
        const mon = new Date(today);
        mon.setDate(today.getDate() - today.getDay() + 1 + offset*7);
        return this.daysOfWeek.map((n,i)=>{
            const d = new Date(mon);
            d.setDate(mon.getDate()+i);
            return {name:n, date:`${d.getDate()}.${d.getMonth()+1}`, full:d.toISOString().split('T')[0]};
        });
    }

    // ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ ÑÐ»Ð¾Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð´Ð½Ñ
    getSlots(i){
        const {work,gym,repair} = this.state.schedule[i];
        const s=[];
        if(work){
            s.push({t:'06:00-06:20', a:'ÐŸÐ¾Ð´ÑŠÐµÐ¼', c:'bg-blue-100', id:'wake', supps:['ÐÐ¼Ð¸Ð½Ð¾ÐºÐ¸ÑÐ»Ð¾Ñ‚Ñ‹','ÐšÑ€ÐµÐ°Ñ‚Ð¸Ð½']});
            s.push({t:'06:20-06:30', a:'Ð¡Ð±Ð¾Ñ€Ñ‹', c:'bg-blue-100', id:'prep'});
            s.push({t:'06:30-07:00', a:'Ð”Ð¾Ñ€Ð¾Ð³Ð°', c:'bg-orange-100', id:'commute1'});
            s.push({t:'07:00-15:00', a:'Ð Ð°Ð±Ð¾Ñ‚Ð°', c:'bg-orange-200', id:'work', supps:['ÐœÑƒÐ»ÑŒÑ‚Ð¸-Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ñ‹','ÐžÐ¼ÐµÐ³Ð° 3']});
            s.push({t:'15:00-15:30', a:'Ð”Ð¾Ñ€Ð¾Ð³Ð°', c:'bg-orange-100', id:'commute2'});
            s.push({t:'15:30-16:00', a:'ÐžÐ±ÐµÐ´', c:'bg-green-100', id:'lunch'});
            s.push(repair ? {t:'16:00-19:00', a:'Ð ÐµÐ¼Ð¾Ð½Ñ‚ 3Ñ‡', c:'bg-yellow-200', id:'repair'} :
                            {t:'16:00-19:00', a:'Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ð¾', c:'bg-gray-100', id:'free1'});
        }else{
            s.push({t:'06:00-09:00', a:'Ð¡Ð¾Ð½ +3Ñ‡', c:'bg-indigo-100', id:'sleep2'});
            s.push({t:'09:00-09:30', a:'ÐŸÐ¾Ð´ÑŠÐµÐ¼', c:'bg-blue-100', id:'wake', supps:['ÐÐ¼Ð¸Ð½Ð¾ÐºÐ¸ÑÐ»Ð¾Ñ‚Ñ‹','ÐšÑ€ÐµÐ°Ñ‚Ð¸Ð½']});
            s.push({t:'09:30-10:30', a:'Ð—Ð°Ð²Ñ‚Ñ€Ð°Ðº', c:'bg-green-100', id:'breakfast', supps:['ÐœÑƒÐ»ÑŒÑ‚Ð¸-Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ñ‹','ÐžÐ¼ÐµÐ³Ð° 3']});
            if(repair){
                s.push({t:'10:30-13:30', a:'Ð ÐµÐ¼Ð¾Ð½Ñ‚ 3Ñ‡', c:'bg-yellow-200', id:'repair1'});
                s.push({t:'13:30-14:30', a:'ÐžÐ±ÐµÐ´', c:'bg-green-100', id:'lunch'});
                s.push({t:'14:30-18:30', a:'Ð ÐµÐ¼Ð¾Ð½Ñ‚ 4Ñ‡', c:'bg-yellow-200', id:'repair2'});
            }else{
                s.push({t:'10:30-13:30', a:'Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ð¾', c:'bg-gray-100', id:'free2'});
                s.push({t:'13:30-14:30', a:'ÐžÐ±ÐµÐ´', c:'bg-green-100', id:'lunch'});
                s.push({t:'14:30-18:30', a:'Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ð¾', c:'bg-gray-100', id:'free3'});
            }
        }

        if(gym){
            s.push({t:'19:00-19:30', a:'Ðš Ð·Ð°Ð»Ñƒ', c:'bg-red-100', id:'gym1', supps:['Ð‘ÐµÑ‚Ð°-Ð°Ð»Ð°Ð½Ð¸Ð½','Ð¦Ð¸Ñ‚Ñ€ÑƒÐ»Ð¸Ð½']});
            s.push({t:'19:30-21:00', a:'Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ°', c:'bg-red-200', id:'gym'});
            s.push({t:'21:00-21:30', a:'ÐžÑ‚ Ð·Ð°Ð»Ð°', c:'bg-red-100', id:'gym2', supps:['ÐšÑ€ÐµÐ°Ñ‚Ð¸Ð½','Ð“ÐµÐ¹Ð½ÐµÑ€']});
            s.push({t:'21:30-22:30', a:'Ð£Ð¶Ð¸Ð½', c:'bg-green-100', id:'dinner'});
            s.push({t:'22:30-23:30', a:'ÐšÑƒÑ€Ñ', c:'bg-purple-200', id:'course'});
            s.push({t:'23:30-00:00', a:'Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ð¾', c:'bg-gray-100', id:'free', supps:['Ð“Ð°Ð±Ð°','B-ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ']});
        }else{
            s.push({t: work?'19:00-20:00':'18:30-19:30', a:'Ð£Ð¶Ð¸Ð½', c:'bg-green-100', id:'dinner'});
            s.push({t: work?'20:00-22:00':'19:30-21:30', a:'ÐšÑƒÑ€Ñ 2Ñ‡', c:'bg-purple-200', id:'course'});
            s.push({t: work?'22:00-00:00':'21:30-00:00', a:'Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ð¾', c:'bg-gray-100', id:'free', supps:['Ð“Ð°Ð±Ð°','B-ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ']});
        }
        s.push({t:'00:00', a:'Ð¡Ð¾Ð½', c:'bg-indigo-200', id:'sleep'});
        return s;
    }

    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
    isCurrent(slot){
        const now=new Date();
        const [startH,startM] = slot.t.split('-')[0].split(':').map(Number);
        const [endH,endM] = (slot.t.split('-')[1]||slot.t.split('-')[0]).split(':').map(Number);
        const startMins=startH*60+startM;
        const endMins=endH*60+endM;
        const curMins=now.getHours()*60+now.getMinutes();
        return curMins>=startMins && curMins<=endMins;
    }

    render(){
        const app=document.getElementById('app');
        app.innerHTML='';
        const days=this.getDays(this.state.weekOffset);
        const dayIndex=this.state.selectedDay;
        const day=days[dayIndex];
        const slots=this.getSlots(dayIndex);

        // Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¸ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸
        const header=document.createElement('div');
        header.className='p-4 flex flex-col gap-2';
        header.innerHTML=`
            <h1 class="text-xl font-bold">ðŸ“… ${day.name} ${day.date}</h1>
            <div class="flex gap-2">
                <button id="btn-work" class="px-3 py-1 rounded ${this.state.schedule[dayIndex].work?'bg-orange-500 text-white':'bg-gray-200'}">Ð Ð°Ð±Ð¾Ñ‚Ð°</button>
                <button id="btn-gym" class="px-3 py-1 rounded ${this.state.schedule[dayIndex].gym?'bg-red-500 text-white':'bg-gray-200'}">Ð—Ð°Ð»</button>
                <button id="btn-repair" class="px-3 py-1 rounded ${this.state.schedule[dayIndex].repair?'bg-yellow-500 text-white':'bg-gray-200'}">Ð ÐµÐ¼Ð¾Ð½Ñ‚</button>
            </div>
        `;
        app.appendChild(header);

        // Ð¡Ð»Ð¾Ñ‚-ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€
        const slotContainer=document.createElement('div');
        slotContainer.className='flex-1 p-4 overflow-y-auto';
        slots.forEach(slot=>{
            const done=this.state.completed[`${day.full}-${slot.id}`];
            const current=this.isCurrent(slot);
            const div=document.createElement('div');
            div.className=`slot p-3 mb-2 rounded ${slot.c} ${current?'current-time':''}`;
            div.dataset.slotid=slot.id;
            div.innerHTML=`
                <div class="flex justify-between items-start">
                    <div>
                        <div class="font-semibold">${slot.t}</div>
                        <div>${slot.a}</div>
                        ${slot.supps?this.renderSupps(slot, day.full):''}
                    </div>
                    <button class="w-6 h-6 border-2 rounded ${done?'bg-green-500':'border-gray-400'}" data-action="done" data-date="${day.full}" data-id="${slot.id}">${done?'âœ“':''}</button>
                </div>
            `;
            slotContainer.appendChild(div);
        });
        app.appendChild(slotContainer);

        // ÐÐ¸Ð¶Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð´Ð½ÐµÐ¹
        const footer=document.createElement('div');
        footer.className='bg-white border-t flex justify-between p-2 sticky bottom-0';
        days.forEach((d,i)=>{
            const btn=document.createElement('button');
            btn.className=`flex-1 py-2 mx-1 rounded ${i===dayIndex?'bg-blue-500 text-white':'bg-gray-200'}`;
            btn.textContent=d.name;
            btn.dataset.day=i;
            footer.appendChild(btn);
        });
        app.appendChild(footer);

        // Ð”ÐµÐ»ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹
        this.bindEvents();
    }

    renderSupps(slot,date){
        if(!slot.supps) return '';
        return slot.supps.map((s,i)=>{
            const key=`${date}-${slot.id}-${i}`;
            const taken=this.state.supplements[key];
            return `<div class="flex items-center gap-2 mb-0.5">
                <button class="w-4 h-4 border rounded" data-action="supp" data-key="${key}">${taken?'âœ“':''}</button>
                <span class="text-xs ${taken?'line-through text-gray-500':'text-teal-700'}">ðŸ’Š ${s}</span>
            </div>`;
        }).join('');
    }

    bindEvents(){
        const app=document.getElementById('app');
        const dayIndex=this.state.selectedDay;

        // Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹/Ð·Ð°Ð»Ð°/Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ð°
        document.getElementById('btn-work').onclick=()=>{this.toggleSlot('work',dayIndex);}
        document.getElementById('btn-gym').onclick=()=>{this.toggleSlot('gym',dayIndex);}
        document.getElementById('btn-repair').onclick=()=>{this.toggleSlot('repair',dayIndex);}

        // Ð½Ð¸Ð¶Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð´Ð½ÐµÐ¹
        Array.from(app.querySelectorAll('div[sticky] button, div[sticky] button')).forEach(btn=>{
            btn.onclick=()=>{this.selectDay(Number(btn.dataset.day));}
        });

        // Ð´ÐµÐ»ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð½Ð° ÑÐ»Ð¾Ñ‚Ñ‹
        app.querySelectorAll('button[data-action]').forEach(btn=>{
            const action=btn.dataset.action;
            if(action==='done'){
                btn.onclick=()=>{this.toggleDone(btn.dataset.date,btn.dataset.id,btn);}
            }else if(action==='supp'){
                btn.onclick=()=>{this.toggleSupp(btn.dataset.key,btn);}
            }
        });
    }

    toggleSlot(type,dayIndex){
        this.state.schedule[dayIndex][type]=!this.state.schedule[dayIndex][type];
        this.save();
        this.render();
    }

    toggleDone(date,id,btn){
        const key=`${date}-${id}`;
        this.state.completed[key]=!this.state.completed[key];
        btn.classList.toggle('bg-green-500');
        btn.classList.toggle('border-gray-400');
        btn.textContent=this.state.completed[key]?'âœ“':'';
        this.save();
    }

    toggleSupp(key,btn){
        this.state.supplements[key]=!this.state.supplements[key];
        btn.textContent=this.state.supplements[key]?'âœ“':'';
        this.save();
    }

    selectDay(i){ this.state.selectedDay=i; this.render(); }

    autoHighlightCurrentTime(){
        setInterval(()=>{
            const slots=document.querySelectorAll('.slot');
            slots.forEach(slot=>{
                const slotId=slot.dataset.slotid;
                const dayIndex=this.state.selectedDay;
                const slotsDay=this.getSlots(dayIndex);
                const slotObj=slotsDay.find(s=>s.id===slotId);
                if(slotObj && this.isCurrent(slotObj)){
                    slot.classList.add('current-time');
                }else{
                    slot.classList.remove('current-time');
                }
            });
        },60000);
    }
}

const app=new Planner();
</script>
</body>
</html>
