<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>–ú–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { overscroll-behavior: none; -webkit-overflow-scrolling: touch; }
        .mobile-tap { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        const storage = {
            get: (k) => { try { return JSON.parse(localStorage.getItem(k)); } catch { return null; } },
            set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
        };

        class App {
            constructor() {
                this.state = {
                    week: 0,
                    schedule: storage.get('schedule') || {
                        0: {work:true, gym:true, repair:true}, 1: {work:false, gym:false, repair:true},
                        2: {work:true, gym:true, repair:true}, 3: {work:false, gym:false, repair:true},
                        4: {work:true, gym:true, repair:true}, 5: {work:false, gym:false, repair:true},
                        6: {work:false, gym:true, repair:true}
                    },
                    completed: storage.get('completed') || {},
                    supplements: storage.get('supplements') || {},
                    showStats: true,
                    showModal: false
                };
                this.suppConfig = [
                    {id:1, name:'–ê–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç—ã', icon:'üíä', timing:'wake'},
                    {id:2, name:'–ö—Ä–µ–∞—Ç–∏–Ω (—É—Ç—Ä–æ)', icon:'üíä', timing:'wake'},
                    {id:3, name:'–ú—É–ª—å—Ç–∏-–í–∏—Ç–∞–º–∏–Ω—ã', icon:'üåü', timing:'breakfast'},
                    {id:4, name:'–û–º–µ–≥–∞ 3', icon:'üêü', timing:'breakfast'},
                    {id:5, name:'–ë–µ—Ç–∞-–∞–ª–∞–Ω–∏–Ω', icon:'‚ö°', timing:'pre-gym', gymOnly:true},
                    {id:6, name:'–¶–∏—Ç—Ä—É–ª–∏–Ω', icon:'‚ö°', timing:'pre-gym', gymOnly:true},
                    {id:7, name:'–ö—Ä–µ–∞—Ç–∏–Ω (–ø–æ—Å–ª–µ)', icon:'üíä', timing:'post-gym', gymOnly:true},
                    {id:8, name:'–ì–µ–π–Ω–µ—Ä', icon:'ü•§', timing:'post-gym', gymOnly:true, opt:true},
                    {id:9, name:'–ì–∞–±–∞', icon:'üò¥', timing:'sleep'},
                    {id:10, name:'B-–∫–æ–º–ø–ª–µ–∫—Å', icon:'üíä', timing:'sleep'}
                ];
            }

            save() {
                storage.set('schedule', this.state.schedule);
                storage.set('completed', this.state.completed);
                storage.set('supplements', this.state.supplements);
            }

            getDays(offset) {
                const names = ['–ü–ù','–í–¢','–°–†','–ß–¢','–ü–¢','–°–ë','–í–°'];
                const today = new Date();
                const mon = new Date(today);
                mon.setDate(today.getDate() - today.getDay() + 1 + offset*7);
                return names.map((n,i) => {
                    const d = new Date(mon);
                    d.setDate(mon.getDate()+i);
                    return {name:n, date:`${d.getDate()}.${d.getMonth()+1}`, full:d.toISOString().split('T')[0]};
                });
            }

            getSlots(i, work, gym, repair) {
                const s = [];
                if (work) {
                    s.push(
                        {t:'06:00-06:20', a:'–ü–æ–¥—ä–µ–º', c:'bg-blue-100', id:'wake', supps:['–ê–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç—ã','–ö—Ä–µ–∞—Ç–∏–Ω']},
                        {t:'06:20-06:30', a:'–°–±–æ—Ä—ã', c:'bg-blue-100', id:'prep'},
                        {t:'06:30-07:00', a:'–î–æ—Ä–æ–≥–∞', c:'bg-orange-100', id:'commute1'},
                        {t:'07:00-15:00', a:'–†–∞–±–æ—Ç–∞', c:'bg-orange-200', id:'work', supps:['–ú—É–ª—å—Ç–∏-–í–∏—Ç–∞–º–∏–Ω—ã','–û–º–µ–≥–∞ 3']},
                        {t:'15:00-15:30', a:'–î–æ—Ä–æ–≥–∞', c:'bg-orange-100', id:'commute2'},
                        {t:'15:30-16:00', a:'–û–±–µ–¥', c:'bg-green-100', id:'lunch'}
                    );
                    s.push(repair ? 
                        {t:'16:00-19:00', a:'–†–µ–º–æ–Ω—Ç 3—á', c:'bg-yellow-200', id:'repair'} :
                        {t:'16:00-19:00', a:'–°–≤–æ–±–æ–¥–Ω–æ', c:'bg-gray-100', id:'free1'}
                    );
                } else {
                    s.push(
                        {t:'06:00-09:00', a:'–°–æ–Ω +3—á', c:'bg-indigo-100', id:'sleep2'},
                        {t:'09:00-09:30', a:'–ü–æ–¥—ä–µ–º', c:'bg-blue-100', id:'wake', supps:['–ê–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç—ã','–ö—Ä–µ–∞—Ç–∏–Ω']},
                        {t:'09:30-10:30', a:'–ó–∞–≤—Ç—Ä–∞–∫', c:'bg-green-100', id:'breakfast', supps:['–ú—É–ª—å—Ç–∏-–í–∏—Ç–∞–º–∏–Ω—ã','–û–º–µ–≥–∞ 3']}
                    );
                    if (repair) {
                        s.push(
                            {t:'10:30-13:30', a:'–†–µ–º–æ–Ω—Ç 3—á', c:'bg-yellow-200', id:'repair1'},
                            {t:'13:30-14:30', a:'–û–±–µ–¥', c:'bg-green-100', id:'lunch'},
                            {t:'14:30-18:30', a:'–†–µ–º–æ–Ω—Ç 4—á', c:'bg-yellow-200', id:'repair2'}
                        );
                    } else {
                        s.push(
                            {t:'10:30-13:30', a:'–°–≤–æ–±–æ–¥–Ω–æ', c:'bg-gray-100', id:'free2'},
                            {t:'13:30-14:30', a:'–û–±–µ–¥', c:'bg-green-100', id:'lunch'},
                            {t:'14:30-18:30', a:'–°–≤–æ–±–æ–¥–Ω–æ', c:'bg-gray-100', id:'free3'}
                        );
                    }
                }
                if (gym) {
                    s.push(
                        {t:'19:00-19:30', a:'–ö –∑–∞–ª—É', c:'bg-red-100', id:'gym1', supps:['–ë–µ—Ç–∞-–∞–ª–∞–Ω–∏–Ω','–¶–∏—Ç—Ä—É–ª–∏–Ω']},
                        {t:'19:30-21:00', a:'–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞', c:'bg-red-200', id:'gym'},
                        {t:'21:00-21:30', a:'–û—Ç –∑–∞–ª–∞', c:'bg-red-100', id:'gym2', supps:['–ö—Ä–µ–∞—Ç–∏–Ω','–ì–µ–π–Ω–µ—Ä']},
                        {t:'21:30-22:30', a:'–£–∂–∏–Ω', c:'bg-green-100', id:'dinner'},
                        {t:'22:30-23:30', a:'–ö—É—Ä—Å', c:'bg-purple-200', id:'course'},
                        {t:'23:30-00:00', a:'–°–≤–æ–±–æ–¥–Ω–æ', c:'bg-gray-100', id:'free', supps:['–ì–∞–±–∞','B-–∫–æ–º–ø–ª–µ–∫—Å']}
                    );
                } else {
                    if (work) {
                        s.push(
                            {t:'19:00-20:00', a:'–£–∂–∏–Ω', c:'bg-green-100', id:'dinner'},
                            {t:'20:00-22:00', a:'–ö—É—Ä—Å 2—á', c:'bg-purple-200', id:'course'},
                            {t:'22:00-00:00', a:'–°–≤–æ–±–æ–¥–Ω–æ', c:'bg-gray-100', id:'free', supps:['–ì–∞–±–∞','B-–∫–æ–º–ø–ª–µ–∫—Å']}
                        );
                    } else {
                        s.push(
                            {t:'18:30-19:30', a:'–£–∂–∏–Ω', c:'bg-green-100', id:'dinner'},
                            {t:'19:30-21:30', a:'–ö—É—Ä—Å 2—á', c:'bg-purple-200', id:'course'},
                            {t:'21:30-00:00', a:'–°–≤–æ–±–æ–¥–Ω–æ', c:'bg-gray-100', id:'free', supps:['–ì–∞–±–∞','B-–∫–æ–º–ø–ª–µ–∫—Å']}
                        );
                    }
                }
                s.push({t:'00:00', a:'–°–æ–Ω', c:'bg-indigo-200', id:'sleep'});
                return s;
            }

            render() {
                const days = this.getDays(this.state.week);
                let html = `
                    <div class="max-w-7xl mx-auto p-4 bg-white min-h-screen">
                        <div class="flex justify-between items-center mb-4">
                            <h1 class="text-2xl font-bold">üìÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫</h1>
                            <div class="flex gap-2">
                                <button onclick="app.modal()" class="px-3 py-2 bg-green-500 text-white rounded">üíä</button>
                                <button onclick="app.prev()" class="px-3 py-2 bg-gray-200 rounded">‚Üê</button>
                                <button onclick="app.next()" class="px-3 py-2 bg-gray-200 rounded">‚Üí</button>
                            </div>
                        </div>
                        ${this.renderStats(days)}
                        ${this.renderTable(days)}
                        ${this.state.showModal ? this.renderModal() : ''}
                    </div>
                `;
                document.getElementById('app').innerHTML = html;
            }

            renderStats(days) {
                let rep=0, gym=0, supp=0, taken=0;
                Object.keys(this.state.schedule).forEach(i => {
                    const d = this.state.schedule[i];
                    if (d.repair) rep += d.work ? 3 : 7;
                    if (d.gym) gym++;
                });
                days.forEach((day,i) => {
                    const slots = this.getSlots(i, this.state.schedule[i].work, this.state.schedule[i].gym, this.state.schedule[i].repair);
                    slots.forEach(slot => {
                        if (slot.supps) {
                            slot.supps.forEach((s,idx) => {
                                supp++;
                                if (this.state.supplements[`${day.full}-${slot.id}-${idx}`]) taken++;
                            });
                        }
                    });
                });
                return `
                    <div class="grid grid-cols-3 gap-3 mb-4 text-sm">
                        <div class="p-3 bg-yellow-50 rounded border-2 border-yellow-200">
                            <div class="text-2xl font-bold text-yellow-700">${rep}—á</div>
                            <div class="text-gray-600">–†–µ–º–æ–Ω—Ç</div>
                        </div>
                        <div class="p-3 bg-red-50 rounded border-2 border-red-200">
                            <div class="text-2xl font-bold text-red-700">${gym}</div>
                            <div class="text-gray-600">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                        </div>
                        <div class="p-3 bg-teal-50 rounded border-2 border-teal-200">
                            <div class="text-2xl font-bold text-teal-700">${taken}/${supp}</div>
                            <div class="text-gray-600">–°–ø–æ—Ä—Ç–ø–∏—Ç</div>
                        </div>
                    </div>
                `;
            }

            renderTable(days) {
                let html = '<div class="overflow-x-auto"><table class="w-full border-collapse text-xs"><thead><tr class="bg-gray-100"><th class="border p-2">–í—Ä–µ–º—è</th>';
                days.forEach((d,i) => {
                    const sch = this.state.schedule[i];
                    html += `
                        <th class="border p-2">
                            <div class="font-bold">${d.name}</div>
                            <div class="text-gray-600">${d.date}</div>
                            <div class="flex flex-wrap gap-1 mt-2 justify-center">
                                <button onclick="app.tog('work',${i})" class="px-2 py-1 text-xs rounded ${sch.work?'bg-orange-500 text-white':'bg-gray-300'}">–†–∞–±–æ—Ç–∞</button>
                                <button onclick="app.tog('gym',${i})" class="px-2 py-1 text-xs rounded ${sch.gym?'bg-red-500 text-white':'bg-gray-300'}">–ó–∞–ª</button>
                                <button onclick="app.tog('repair',${i})" class="px-2 py-1 text-xs rounded ${sch.repair?'bg-yellow-500 text-white':'bg-gray-300'}">–†–µ–º–æ–Ω—Ç</button>
                            </div>
                        </th>
                    `;
                });
                html += '</tr></thead><tbody>';
                
                for (let r=0; r<16; r++) {
                    html += '<tr>';
                    html += '<td class="border p-2 bg-gray-50"></td>';
                    days.forEach((day,i) => {
                        const sch = this.state.schedule[i];
                        const slots = this.getSlots(i, sch.work, sch.gym, sch.repair);
                        const slot = slots[r];
                        if (slot) {
                            const done = this.state.completed[`${day.full}-${slot.id}`];
                            html += `
                                <td class="border p-2 ${slot.c}">
                                    <div class="flex gap-2">
                                        <div class="flex-1">
                                            <div class="font-semibold">${slot.t}</div>
                                            <div>${slot.a}</div>
                                            ${slot.supps ? this.renderSupps(slot, day.full) : ''}
                                        </div>
                                        <button onclick="app.done('${day.full}','${slot.id}')" class="w-5 h-5 border-2 rounded ${done?'bg-green-500':'border-gray-300'}">
                                            ${done?'‚úì':''}
                                        </button>
                                    </div>
                                </td>
                            `;
                        } else {
                            html += '<td class="border p-2"></td>';
                        }
                    });
                    html += '</tr>';
                }
                
                html += '</tbody></table></div>';
                return html;
            }

            renderSupps(slot, date) {
                if (!slot.supps) return '';
                let html = '<div class="mt-1 pt-1 border-t border-teal-300 bg-teal-50 -mx-1 px-1 py-1 rounded">';
                slot.supps.forEach((s,i) => {
                    const key = `${date}-${slot.id}-${i}`;
                    const taken = this.state.supplements[key];
                    html += `
                        <div class="flex items-center gap-1 mb-0.5">
                            <button onclick="app.supp('${key}')" class="w-3 h-3 border rounded ${taken?'bg-green-500':'border-gray-400'}">
                                ${taken?'‚úì':''}
                            </button>
                            <span class="text-xs ${taken?'line-through text-gray-500':'text-teal-700'}">üíä ${s}</span>
                        </div>
                    `;
                });
                html += '</div>';
                return html;
            }

            renderModal() {
                return `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this) app.modal()">
                        <div class="bg-white rounded-lg p-6 max-w-md w-full max-h-96 overflow-y-auto">
                            <div class="flex justify-between mb-4">
                                <h2 class="text-xl font-bold">üíä –°–ø–æ—Ä—Ç–ø–∏—Ç</h2>
                                <button onclick="app.modal()" class="text-2xl">&times;</button>
                            </div>
                            <div class="space-y-2">
                                ${this.suppConfig.map(s => `
                                    <div class="flex items-center gap-2 p-2 bg-gray-50 rounded">
                                        <span class="text-xl">${s.icon}</span>
                                        <div class="flex-1">
                                            <div class="font-semibold">${s.name}</div>
                                            <div class="text-xs text-gray-600">${s.gymOnly?'–¢–æ–ª—å–∫–æ –≤ –¥–Ω–∏ –∑–∞–ª–∞':''}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            tog(type, i) {
                this.state.schedule[i][type] = !this.state.schedule[i][type];
                this.save();
                this.render();
            }

            done(date, id) {
                const key = `${date}-${id}`;
                this.state.completed[key] = !this.state.completed[key];
                this.save();
                this.render();
            }

            supp(key) {
                this.state.supplements[key] = !this.state.supplements[key];
                this.save();
                this.render();
            }

            prev() {
                this.state.week--;
                this.render();
            }

            next() {
                this.state.week++;
                this.render();
            }

            modal() {
                this.state.showModal = !this.state.showModal;
                this.render();
            }
        }

        const app = new App();
        app.render();
    </script>
</body>
</html>
